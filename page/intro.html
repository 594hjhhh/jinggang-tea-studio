<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>古法茶韵坊</title>  
    <link rel="stylesheet" href="../css/common.css">
    <style> 
        .main-title {  
            font-family: m1Font, serif;  
            font-size: 60px;  
            color: #2c4a3e;  
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);  
            margin-bottom: 40px;  
            text-align: center;  
            position: relative;  
            animation: fadeIn 1.5s ease-in-out;  
        }  

        @keyframes fadeIn {  
            from {  
                opacity: 0;  
                transform: translateY(-20px);  
            }  
            to {  
                opacity: 1;  
                transform: translateY(0);  
            }  
        }  

         
         body {  
            padding-top: 30px;
            display: flex;  
            align-items: center;  
            justify-content: center;  
            flex-direction: column;  
            height: 100vh;  
            background-image: url("../images/intro/intro_bg.gif");
            background-repeat: no-repeat;
            background-size: cover;
            background-size: 100% 100%;
            overflow: hidden;  
        }  

        /* 定义外层容器样式 */  
        .shell {  
            position: relative;  
            /* 相对定位 */  
            width: 60vw;  
            /* 宽度占视口宽度的60% */  
            height: 40vw;  
            /* 高度占视口高度的40% */  
            max-width: 380px;  
            /* 最大宽度为380像素 */  
            max-height: 250px;  
            /* 最大高度为250像素 */  
            margin: 0;  
            /* 外边距为0 */  
            color: white;  
            /* 字体颜色为白色 */  
            perspective: 1000px;  
            /* 透视效果，观察者与z=0平面的距离 */  
            transform-origin: center;  
            /* 变形原点为中心 */  
            cursor: grab;  
            /* 当可拖动时显示抓取光标 */  
        }  

        .shell:active {  
            cursor: grabbing;  
            /* 拖动时显示抓取中光标 */  
        }  

        /* 定义内容容器样式 */  
        .content {  
            display: flex;  
            /* 设置为弹性盒子布局 */  
            justify-content: center;  
            /* 主轴居中对齐 */  
            align-items: center;  
            /* 交叉轴居中对齐 */  
            position: absolute;  
            /* 绝对定位 */  
            width: 100%;  
            /* 宽度100% */  
            height: 100%;  
            /* 高度100% */  
            transform-origin: center;  
            /* 变形原点为中心 */  
            transform-style: preserve-3d;  
            /* 保持3D变换 */  
            transform: translateZ(-35vw) rotateY(0);  
            /* 变换：沿z轴平移-35vw，绕y轴旋转0度 */  
            transition: transform 0.7s ease-out;  
            /* 添加过渡效果，使旋转更平滑 */  
        }  

        /* 定义项目样式 */  
        .item {  
            position: absolute;  
            /* 绝对定位 */  
            width: 60vw;  
            /* 宽度占视口宽度的60% */  
            height: 40vw;  
            /* 高度占视口高度的40% */  
            max-width: 380px;  
            /* 最大宽度为380像素 */  
            max-height: 250px;  
            /* 最大高度为250像素 */  
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);  
            /* 设置阴影 */  
            border-radius: 6px;  
            /* 边框圆角半径为6像素 */  
            background-size: cover;  
            /* 背景图片等比例缩放并覆盖整个容器 */  
            -webkit-box-reflect: below 25px -webkit-linear-gradient(transparent 50%, rgba(255, 255, 255, 0.3));  
            /* 创建倒影效果 */  
            display: flex;  
            flex-direction: column;  
            justify-content: flex-start;  
            align-items: center;  
            overflow: hidden;  
        }  

        /* 项目链接样式 */  
        .item-link {  
            position: absolute;  
            width: 100%;  
            height: 100%;  
            top: 0;  
            left: 0;  
            z-index: 10;  
            text-decoration: none;  
            color: white;  
        }  

        /* 项目标题样式 */  
        .item-title {  
            position: absolute;  
            top: 0;  
            left: 0;  
            width: 100%;  
            padding: 10px;  
            background-color: rgba(0, 0, 0, 0.5);  
            color: white;  
            text-align: center;  
            font-size: 16px;  
            font-weight: bold;  
            box-sizing: border-box;  
            z-index: 5;  
        }  

        /* 第一个项目样式 */  
        .item:nth-child(1) {  
            background-image: url("../images/intro/tea-art.png");  
            /* 背景图片为01.jpg */  
            transform: rotateY(0) translateZ(35vw);  
            /* 变换：绕y轴旋转0度，沿z轴平移35vw */  
        }  

        /* 第二个项目样式 */  
        .item:nth-child(2) {  
            background-image: url("../images/intro/tea-etiquette.png");  
            /* 背景图片为02.jpg */  
            transform: rotateY(120deg) translateZ(35vw);  
            /* 变换：绕y轴旋转120度，沿z轴平移35vw */  
        }  

        /* 第三个项目样式 */  
        .item:nth-child(3) {  
            background-image: url("../images/intro/tea-blog.png");  
            /* 背景图片为03.jpg */  
            transform: rotateY(240deg) translateZ(35vw);  
            /* 变换：绕y轴旋转240度，沿z轴平移35vw */  
        }  

        /* 模式指示器 - 只显示一个小点 */  
        .mode-indicator {  
            position: absolute;  
            bottom: -30px;  
            left: 50%;  
            transform: translateX(-50%);  
            width: 10px;  
            height: 10px;  
            border-radius: 50%;  
            background-color: white;  
            opacity: 0;  
            transition: opacity 0.3s, background-color 0.3s;  
        }  

        .mode-indicator.visible {  
            opacity: 1;  
        }  

        .mode-indicator.auto {  
            background-color: #4CAF50;  
        }  

        .mode-indicator.manual {  
            background-color: #FF5722;  
        }  
    </style>  
</head>  
<body>
    <div class="main-title">古法茶韵坊</div>    
    <div class="shell">  
        <div class="content">  
            <div class="item">  
                <div class="item-title" style="font-family: m1Font;font-size: 26px;">翠茗艺境</div>  
                <a href="../page/tea_art.html" class="item-link" target="_blank"></a>  
            </div>  
            <div class="item">  
                <div class="item-title" style="font-family: m1Font;font-size: 26px;">绿礼承芳</div>  
                <a href="../page/tea_etiquette.html" class="item-link" target="_blank"></a>  
            </div>  
            <div class="item">  
                <div class="item-title" style="font-family: m1Font;font-size: 26px;">青语茶轩</div>  
                <a href="../html/tea_making.html" class="item-link" target="_blank"></a>  
            </div>  
        </div>  
        <div class="mode-indicator"></div>  
    </div>  

    <script>  
        document.addEventListener('DOMContentLoaded', function() {  
            const shell = document.querySelector('.shell');  
            const content = document.querySelector('.content');  
            const modeIndicator = document.querySelector('.mode-indicator');  
            
            let isDragging = false;  
            let startX = 0;  
            let startRotation = 0;  
            let currentRotation = 0;  
            let dragThreshold = 50; // 拖动阈值，防止微小移动触发旋转  
            let dragDistance = 0;  
            let isAutoRotating = true;  
            
            // 自动恢复计时器  
            let autoResumeTimer = null;  
            let lastInteractionTime = Date.now();  
            const autoResumeDelay = 3000; // 3秒无交互后恢复自动轮播  
            
            // 自动轮播动画参数  
            let rotationInterval;  
            const rotationSpeed = 3000; // 每张图片停留时间  
            const anglePerSlide = 120; // 每张图片的角度间隔  
            
            // 开始从当前位置自动轮播 - 修改为始终朝一个方向旋转  
            function startRotationFromCurrent() {  
                // 先对齐到最近的图片位置  
                snapToNearestSlide();  
                
                // 清除可能存在的旧间隔  
                clearInterval(rotationInterval);  
                
                // 设置新的间隔，持续向一个方向旋转  
                rotationInterval = setInterval(() => {  
                    if (!isDragging) {  
                        // 每次减少一个角度单位  
                        currentRotation -= anglePerSlide;  
                        
                        // 使用过渡效果实现平滑旋转  
                        setRotation(currentRotation);  
                    }  
                }, rotationSpeed);  
                
                isAutoRotating = true;  
                showModeIndicator('auto');  
            }  
            
            // 停止自动旋转  
            function stopAutoRotation() {  
                clearInterval(rotationInterval);  
                isAutoRotating = false;  
                showModeIndicator('manual');  
            }  
            
            // 创建定期检查函数  
            function createAutoResumeChecker() {  
                return setInterval(() => {  
                    const now = Date.now();  
                    // 如果已经处于自动模式，不需要操作  
                    if (isAutoRotating) return;  
                    
                    // 如果自上次交互已过去够长时间，恢复自动轮播  
                    if (now - lastInteractionTime >= autoResumeDelay) {  
                        startRotationFromCurrent();  
                    }  
                }, 1000); // 每秒检查一次  
            }  
            
            // 启动自动检查  
            autoResumeTimer = createAutoResumeChecker();  
            
            // 显示模式指示器  
            function showModeIndicator(mode) {  
                modeIndicator.classList.remove('auto', 'manual');  
                modeIndicator.classList.add('visible', mode);  
                
                // 3秒后隐藏指示器  
                setTimeout(() => {  
                    modeIndicator.classList.remove('visible');  
                }, 2000);  
            }  
            
            // 更新最后交互时间  
            function updateLastInteraction() {  
                lastInteractionTime = Date.now();  
            }  
            
            // 获取当前旋转角度  
            function getCurrentRotation() {  
                const style = window.getComputedStyle(content);  
                const matrix = new DOMMatrix(style.transform);  
                // 从变换矩阵中提取Y轴旋转角度  
                const rotateY = Math.atan2(matrix.m13, matrix.m11) * (180 / Math.PI);  
                return rotateY;  
            }  
            
            // 设置旋转角度  
            function setRotation(angle) {  
                content.style.transform = `translateZ(-35vw) rotateY(${angle}deg)`;  
            }  
            
            // 将角度对齐到最近的滑块位置  
            function snapToNearestSlide() {  
                const slideCount = 3;  
                
                // 标准化旋转角度  
                let normalizedAngle = currentRotation % 360;  
                if (normalizedAngle > 0) normalizedAngle -= 360;  
                
                // 找到最近的滑块位置  
                let closestSlide = Math.round(normalizedAngle / -anglePerSlide);  
                // 确保值在有效范围内  
                closestSlide = closestSlide % slideCount;  
                
                // 转换为实际角度  
                const snapAngle = -closestSlide * anglePerSlide;  
                
                // 应用对齐动画  
                setRotation(snapAngle);  
                currentRotation = snapAngle;  
            }  
            
            // 手动旋转到下一张或上一张  
            function rotateToSlide(direction) {  
                // 停止自动旋转  
                stopAutoRotation();  
                
                // 计算新的旋转角度  
                currentRotation += direction * anglePerSlide;  
                
                // 应用新的旋转角度  
                setRotation(currentRotation);  
                
                // 更新最后交互时间  
                updateLastInteraction();  
            }  
            
            // 初始化自动轮播  
            startRotationFromCurrent();  
            
            // 鼠标按下事件  
            shell.addEventListener('mousedown', function(e) {  
                isDragging = true;  
                startX = e.clientX;  
                
                // 如果在自动旋转中，停止它  
                if (isAutoRotating) {  
                    stopAutoRotation();  
                }  
                
                startRotation = currentRotation;  
                dragDistance = 0;  
                
                // 更新最后交互时间  
                updateLastInteraction();  
                
                // 阻止默认事件和文本选择  
                e.preventDefault();  
                shell.style.cursor = 'grabbing';  
            });  
            
            // 鼠标移动事件  
            window.addEventListener('mousemove', function(e) {  
                if (!isDragging) return;  
                
                const deltaX = e.clientX - startX;  
                dragDistance = deltaX;  
                
                // 更新最后交互时间  
                updateLastInteraction();  
                
                // 设置视觉反馈但不实际旋转，等待达到阈值  
                if (Math.abs(dragDistance) < dragThreshold) {  
                    // 只提供小的视觉反馈  
                    const tempRotation = startRotation + (dragDistance * 0.2);  
                    setRotation(tempRotation);  
                }  
            });  
            
            // 鼠标释放事件  
            window.addEventListener('mouseup', function() {  
                if (!isDragging) return;  
                
                isDragging = false;  
                shell.style.cursor = 'grab';  
                
                // 更新最后交互时间  
                updateLastInteraction();  
                
                // 如果拖动距离超过阈值，则旋转到下一张或上一张  
                if (Math.abs(dragDistance) >= dragThreshold) {  
                    // 确定方向：正值向左滑（显示下一张），负值向右滑（显示上一张）  
                    const direction = dragDistance > 0 ? 1 : -1;  
                    rotateToSlide(direction);  
                } else {  
                    // 如果拖动不够，回到原位  
                    setRotation(startRotation);  
                    currentRotation = startRotation;  
                }  
            });  
            
            // 鼠标离开窗口事件  
            window.addEventListener('mouseleave', function() {  
                if (isDragging) {  
                    isDragging = false;  
                    shell.style.cursor = 'grab';  
                    setRotation(startRotation);  
                    currentRotation = startRotation;  
                }  
            });  
            
            // 触摸开始事件 - 移动设备支持  
            shell.addEventListener('touchstart', function(e) {  
                if (e.touches.length === 1) {  
                    isDragging = true;  
                    startX = e.touches[0].clientX;  
                    
                    // 如果在自动旋转中，停止它  
                    if (isAutoRotating) {  
                        stopAutoRotation();  
                    }  
                    
                    startRotation = currentRotation;  
                    dragDistance = 0;  
                    
                    // 更新最后交互时间  
                    updateLastInteraction();  
                    
                    // 阻止触摸事件的默认行为（如滚动）  
                    e.preventDefault();  
                }  
            }, { passive: false });  
            
            // 触摸移动事件  
            window.addEventListener('touchmove', function(e) {  
                if (!isDragging || e.touches.length !== 1) return;  
                
                const deltaX = e.touches[0].clientX - startX;  
                dragDistance = deltaX;  
                
                // 更新最后交互时间  
                updateLastInteraction();  
                
                // 设置视觉反馈但不实际旋转，等待达到阈值  
                if (Math.abs(dragDistance) < dragThreshold) {  
                    // 只提供小的视觉反馈  
                    const tempRotation = startRotation + (dragDistance * 0.2);  
                    setRotation(tempRotation);  
                }  
                
                // 阻止页面滚动  
                e.preventDefault();  
            }, { passive: false });  
            
            // 触摸结束事件  
            window.addEventListener('touchend', function() {  
                if (isDragging) {  
                    isDragging = false;  
                    
                    // 更新最后交互时间  
                    updateLastInteraction();  
                    
                    // 如果拖动距离超过阈值，则旋转到下一张或上一张  
                    if (Math.abs(dragDistance) >= dragThreshold) {  
                        // 确定方向：正值向左滑（显示下一张），负值向右滑（显示上一张）  
                        const direction = dragDistance > 0 ? 1 : -1;  
                        rotateToSlide(direction);  
                    } else {  
                        // 如果拖动不够，回到原位  
                        setRotation(startRotation);  
                        currentRotation = startRotation;  
                    }  
                }  
            });  
            
            // 禁用拖拽图片的默认行为  
            content.addEventListener('dragstart', function(e) {  
                e.preventDefault();  
            });  
            
            // 禁止链接点击导致拖动中断  
            document.querySelectorAll('.item-link').forEach(link => {  
                link.addEventListener('click', function(e) {  
                    // 如果在拖动过程中点击链接，阻止默认行为  
                    if (isDragging || Math.abs(dragDistance) >= dragThreshold) {  
                        e.preventDefault();  
                    }  
                });  
            });  
        });  
    </script>  
</body>  
</html>  